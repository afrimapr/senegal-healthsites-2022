---
title: "Exploring PATH health facility data 2022"
#output: html_document
author: "Andy South @afrimapr"
date: "`r Sys.Date()`"
output: pdf_document
urlcolor: blue
always_allow_html: true
---

DRAFT

[Code for this document](https://github.com/afrimapr/senegal-healthsites-2022/blob/master/senegal-PATH-data-exlore.Rmd)   

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message=FALSE)

library(knitr)
library(tidyverse)
library(sf)
library(tmap)

```


```{r read-data-path, include=FALSE}

# get local file data, can't share yet

# saved first sheet from xls as csv
# xls emailed from Mark 

folder <- "C:\\Users\\andy.south\\Google Drive\\afrimapr-gdrive\\Proposals\\2022-01-senegal-covidaction\\data\\"
filename <- "2022-02-senegal-structures.csv"
filename <- paste0(folder,filename)

#read in csv
#encoding fixes accents
dfpath <- read_csv(filename, locale=locale(encoding = "ISO-8859-1"))

# [1] "Région Médicale"      "District de Santé"    "Structure sanitaire"  "Type structure" 
# [5] "Autre type structure" "Statut"               "Latitude"             "Longitude"   


#convert column names to lowercase & remove any accents and spaces
names(dfpath) <- names(dfpath) %>% 
  #fix accents
  #str_conv(encoding = "ISO-8859-1") %>% 
  #remove accents
  stringi::stri_trans_general("Latin-ASCII") %>%
  #lower case
  str_to_lower() %>% 
  #replace spaces with _
  str_replace_all("\\s", "_")

table(dfpath$type_structure)
# autre   CMG    CS    HP    PS    RM 
#    36     1   100    12  1322    14 

# This legend appears in one file
# Type structure	
# PS	Poste de Santé
# DS	District de Sanitaire (Centre de santé)
# CS	Centre de Santé
# HP	Hopital
# RM	Région Médical
# autre	(Clinique, maternité, unité de vaccination, Dispensaire, etc;)

table(dfpath$statut) #priv-publ
# Communautaire    Prive conf    Prive laic        Public 
#             1            39            35          1410 
```

```{r make-geo-path, include=FALSE}

sfpath <- st_as_sf(dfpath, 
                  coords=c("longitude", "latitude"), 
                  na.fail = FALSE, crs=4326)

sfpath_sl <- filter(sfpath, region_medicale == "Saint Louis")

table(sfpath_sl$type_structure)
# autre   CMG    CS    HP    PS    RM 
#     2     1     6     1   110     1 

```


### Categories of PATH health facilities Saint Louis

```{r map-path-sl, eval=TRUE, fig.height=4}

#, fig.show='hold'

library(tmap)
library(afriadmin)

sfsen_adm0 <- afriadmin('senegal',level=0, plot=FALSE)
sfsen_adm1 <- afriadmin('senegal',level=1, plot=FALSE)

#map category types
tmap::tm_shape(filter(sfsen_adm1, shapeName=="Saint Louis")) +
    tm_borders("grey", lwd = .5) +
    tm_shape(sfsen_adm0) +
    tm_borders("black", lwd = .5) +
  
  tm_shape(sfpath_sl) +
    #tm_dots(shape=3, size = 0.15, col='red', border.lwd = 0.2) +
  

  #0square,1circle,2triangle,3+,4x,5diamond
  
    tm_symbols(shape="type_structure", col='red', shapes=c(0,1,3,2,4,5), size=0.1) +
  
    tm_layout(main.title='PATH health facilities Saint Louis 2022', main.title.size=1,
              legend.bg.color=TRUE, legend.position=c("center","BOTTOM"),
              title="map by @afrimapr", title.color="darkgrey", title.size=0.8, title.position=c("RIGHT","BOTTOM")) #main.title goes above map
   
#map statut (publ/priv)
tmap::tm_shape(filter(sfsen_adm1, shapeName=="Saint Louis")) +
    tm_borders("grey", lwd = .5) +
    tm_shape(sfsen_adm0) +
    tm_borders("black", lwd = .5) +
  
  tm_shape(sfpath_sl) +

  
  #0square,1circle,2triangle,3+,4x
  
    tm_symbols(shape="statut", col='darkgreen', shapes=c(0,1,2,3), size=0.1) +
  
    tm_layout(main.title='PATH health facilities Saint Louis 2022', main.title.size=1,
              legend.bg.color=TRUE, legend.position=c("center","BOTTOM"),
              title="map by @afrimapr", title.color="darkgrey", title.size=0.8, title.position=c("RIGHT","BOTTOM")) #main.title goes above map


```




